import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import { ValidationPipe } from '@nestjs/common';
import { ResponseInterceptor } from './utils/ParserCourserListHandler';
import { DocumentBuilder, SwaggerModule } from '@nestjs/swagger';
import { NestExpressApplication } from '@nestjs/platform-express';

const key = () => {
  return `-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAxn3018A3x32uneRIat9WoKUrC6+mv6K9vVMjtqswHyHAmnzf
KA8AZSw2fYxCc0yUZwzNQ+HcXSzPpkKhImCoQO3hicYfsAAoLvCSXs+k9HvXlzYL
H7Des5YR9UGNHswzfe5ayUg8JXAlNkyAmKRuB6XPHreYiGCy4bsnUwHCNOBn28Kx
WNv42QZqDGFIzC0Cqzw1R1bs+jLuFFQFQbaYKialcDGKOjQ0YCZUJEvdT9NY8cv+
z6J9ipIpyOVQmWQpYzZsyjOdEtcIp+nQVPXc21/fugwZY3TQa45m+vcFeMdKAU91
7S8iLeSLi3dx/xPs8KzQ6aVFxNvOFjQ+45UEoQIDAQABAoIBABB/m/Q6d5By/YqF
dPEALR/Hds1e/WfYn7eOw21Nq59s02jr5/MZEx31t7ZGDChwBTZPEbk6mvHaNYzS
5TiZquaRt0FXyN681po3OB1eGk6RhCUfEnvg/FPWTZoSh6e3jrChGSX5pXkxqgAq
SfaWFUi4sx9xIII2cmvxndZIE0PIfU+tZ2rB1sPNeKHOZhrJzf0XnTb+mPLC/iGb
u0TfcTINQDTIeTITvQt/wju63ZvBAQX4I4LdZ/cUd5Kzz6aTwpExHenN7rpx2yp7
7e2fnEGVfdRXMzvNs7r9YsqueoZOAdMvL/x2Pty4h3Ig/EyLj0bP+5ZciF3RSpnb
wpapy4kCgYEA6G4ljRfws8e80U1O+5/oYQFdDy13xC2W0WAko8Pz7WjH9X4gtGeT
ZZk5VYuKLXz6G4NxKR5vmiyGGTdaUSj6RQdTBPDi1z1uv993qvQC2olL+vd3p/1M
0562ogFghbTUoQSOSs3o2Rf9ADRpQXwrSQLFlLE+ExA1RopS4JAlzukCgYEA2p7H
OihRGe5daf8nXAU8rqOZT7jM5gmePOEGXaB62XH95QTifkG6SnyEqovmFhRRunB3
xdxMFGPKIphNz6r/S2FfSSQrGUp8YBmenQaZbidM7p6LgqnolulgCsJwK7aNg8CY
KD4ZLC3lC7SmQF7qyXkAooq4nj5PNGMr5jpGJPkCgYEAvcpDK2TjDUoJqjagSeMX
Ey7T2DLeWviG8Ey7XmYBZlhq/tCQz/7LYuis4mdg2yfz6kd4PYU2yAOXNDv4qdD2
GyuR5LT15Z+qMU6+Hn/FXMFDo5gywp+Y/ivZIYxSTpuMDDb2IarleW+XDXW+hNRp
W+LBh1r7PwG7HvCQIAJUfRECgYA6AAPlFwslMQsRcwMTM8R8pKSo9ONPaF/V0PFq
Z4gQJmDwoJIiYve0iUJ9KK57Txq7ttjf4mlAw5S+BuAl5zzh18x60CCrDgrfSAy/
ph+QjNapO+DRYph1aSb0088EmeMDgFYd3xO4l9h7eYrd6xCpMPQNK3Z9bRSAVosw
AmfXqQKBgH5XsGuCiZ2dm6fWY0lW8GBSyJ9TXrlntEjHpe4ZVrYQA1OlR8k3gOCB
AjcRK6Z0Dn/H7loLCI6gJlcv16rR7ZgSX9WrTA2ELBL4Z7VpiV6153BjxDafGQBl
v8YV+Do10CUXgFmRYsETSJYlV9A3G3sPbook1LlK5fWPAo60Lgqn
-----END RSA PRIVATE KEY-----`;
};
const cert = () => {
  return `-----BEGIN CERTIFICATE-----
MIIGeDCCBOCgAwIBAgIQF14DZVWJkDZ7Xozjzl9OojANBgkqhkiG9w0BAQwFADBZ
MQswCQYDVQQGEwJDTjElMCMGA1UEChMcVHJ1c3RBc2lhIFRlY2hub2xvZ2llcywg
SW5jLjEjMCEGA1UEAxMaVHJ1c3RBc2lhIFJTQSBEViBUTFMgQ0EgRzIwHhcNMjQw
NDEyMDAwMDAwWhcNMjUwNDEyMjM1OTU5WjAZMRcwFQYDVQQDEw5jaGVuanVlLm9u
bGluZTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMZ99NfAN8d9rp3k
SGrfVqClKwuvpr+ivb1TI7arMB8hwJp83ygPAGUsNn2MQnNMlGcMzUPh3F0sz6ZC
oSJgqEDt4YnGH7AAKC7wkl7PpPR715c2Cx+w3rOWEfVBjR7MM33uWslIPCVwJTZM
gJikbgelzx63mIhgsuG7J1MBwjTgZ9vCsVjb+NkGagxhSMwtAqs8NUdW7Poy7hRU
BUG2mCompXAxijo0NGAmVCRL3U/TWPHL/s+ifYqSKcjlUJlkKWM2bMoznRLXCKfp
0FT13Ntf37oMGWN00GuOZvr3BXjHSgFPde0vIi3ki4t3cf8T7PCs0OmlRcTbzhY0
PuOVBKECAwEAAaOCAvowggL2MB8GA1UdIwQYMBaAFF86fBEQfgxncWHci6O1AANn
9VccMB0GA1UdDgQWBBTbWq0eC51GcXokjAVau4T6VZA49TAOBgNVHQ8BAf8EBAMC
BaAwDAYDVR0TAQH/BAIwADAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIw
SQYDVR0gBEIwQDA0BgsrBgEEAbIxAQICMTAlMCMGCCsGAQUFBwIBFhdodHRwczov
L3NlY3RpZ28uY29tL0NQUzAIBgZngQwBAgEwfQYIKwYBBQUHAQEEcTBvMEIGCCsG
AQUFBzAChjZodHRwOi8vY3J0LnRydXN0LXByb3ZpZGVyLmNuL1RydXN0QXNpYVJT
QURWVExTQ0FHMi5jcnQwKQYIKwYBBQUHMAGGHWh0dHA6Ly9vY3NwLnRydXN0LXBy
b3ZpZGVyLmNuMC0GA1UdEQQmMCSCDmNoZW5qdWUub25saW5lghJ3d3cuY2hlbmp1
ZS5vbmxpbmUwggF8BgorBgEEAdZ5AgQCBIIBbASCAWgBZgB2AM8RVu7VLnyv84db
2Wkum+kacWdKsBfsrAHSW3fOzDsIAAABjtBmwtMAAAQDAEcwRQIhAN2YqAd4Zr69
fIk1acN6o2/DqVJXq3azOek+SBJ9w90kAiBna3M3F2nZj3QKpJSIWXUdSew0LbxR
Q19wgxBy4AhqVQB1AKLjCuRF772tm3447Udnd1PXgluElNcrXhssxLlQpEfnAAAB
jtBmwoMAAAQDAEYwRAIgBlTwmdlF5nNp4AigUo194hDu1Ij+B8L2VsxD1W88VJ8C
IEncAn1Fe4mXDSkQ6zZHPTjK9lRaKVN3ygXZjQVqo6p+AHUATnWjJ1yaEMM4W2zU
3z9S6x3w4I4bjWnAsfpksWKaOd8AAAGO0GbCcgAABAMARjBEAiAp1JcTcYxEvG04
uj9s1IG3XT0abfSYiDnPe4WHITTlGQIgGKSXItPgR3n2UTv/wmlBJ4fMlysUZnDy
bpZRBjhLzI0wDQYJKoZIhvcNAQEMBQADggGBAGWNGx9rz2QPnnrqpElwtBo/uOqu
zlQeyyRCyyc1HUrtso82vkkl4okYG/uYuD7dsxU5huiDzywaSPk23UAtTmDF9RX0
FxVen2R7gN1C7fwztBoWH89c84xEGBSZ0uxPubxUTyf+8jAhIYfqwZY+y+RoAu6d
5ii7Yrmzts5NprtjXLSrtUS2woZeW3QgtUXuW3kReZdnsQTqGUWM/dqq2zjXotjr
fL8piSjSVkOigV60ef91ldudMAGxKqt0bdCRKfxauEFuF2gnhEOqacTG/hCb2Lpx
vcNaYDRZx5yNw+veFev95gYE9m5l9pWL30FEOmflIRzLB4HewDzY06V+KqYN9iZ6
cOFDrDfGl7+4SzY9Lhqplb01o1495Yb13gXuA+MQLIfprRO2WUQDMcYzimmDlAUS
K44JindBqWvx/st1HixR3xELN1ea1dPZHMi/aaNgYpj7ar3Q3JxwP5ac06V1Nfh6
34EOm++ylJgGRhXahxG5KzduMys6IyG19mLWCw==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIFBzCCA++gAwIBAgIRALIM7VUuMaC/NDp1KHQ76aswDQYJKoZIhvcNAQELBQAw
ezELMAkGA1UEBhMCR0IxGzAZBgNVBAgMEkdyZWF0ZXIgTWFuY2hlc3RlcjEQMA4G
A1UEBwwHU2FsZm9yZDEaMBgGA1UECgwRQ29tb2RvIENBIExpbWl0ZWQxITAfBgNV
BAMMGEFBQSBDZXJ0aWZpY2F0ZSBTZXJ2aWNlczAeFw0yMjAxMTAwMDAwMDBaFw0y
ODEyMzEyMzU5NTlaMFkxCzAJBgNVBAYTAkNOMSUwIwYDVQQKExxUcnVzdEFzaWEg
VGVjaG5vbG9naWVzLCBJbmMuMSMwIQYDVQQDExpUcnVzdEFzaWEgUlNBIERWIFRM
UyBDQSBHMjCCAaIwDQYJKoZIhvcNAQEBBQADggGPADCCAYoCggGBAKjGDe0GSaBs
Yl/VhMaTM6GhfR1TAt4mrhN8zfAMwEfLZth+N2ie5ULbW8YvSGzhqkDhGgSBlafm
qq05oeESrIJQyz24j7icGeGyIZ/jIChOOvjt4M8EVi3O0Se7E6RAgVYcX+QWVp5c
Sy+l7XrrtL/pDDL9Bngnq/DVfjCzm5ZYUb1PpyvYTP7trsV+yYOCNmmwQvB4yVjf
IIpHC1OcsPBntMUGeH1Eja4D+qJYhGOxX9kpa+2wTCW06L8T6OhkpJWYn5JYiht5
8exjAR7b8Zi3DeG9oZO5o6Qvhl3f8uGU8lK1j9jCUN/18mI/5vZJ76i+hsgdlfZB
Rh5lmAQjD80M9TY+oD4MYUqB5XrigPfFAUwXFGehhlwCVw7y6+5kpbq/NpvM5Ba8
SeQYUUuMA8RXpTtGlrrTPqJryfa55hTuX/ThhX4gcCVkbyujo0CYr+Uuc14IOyNY
1fD0/qORbllbgV41wiy/2ZUWZQUodqHWkjT1CwIMbQOY5jmrSYGBwwIDAQABo4IB
JjCCASIwHwYDVR0jBBgwFoAUoBEKIz6W8Qfs4q8p74Klf9AwpLQwHQYDVR0OBBYE
FF86fBEQfgxncWHci6O1AANn9VccMA4GA1UdDwEB/wQEAwIBhjASBgNVHRMBAf8E
CDAGAQH/AgEAMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAiBgNVHSAE
GzAZMA0GCysGAQQBsjEBAgIxMAgGBmeBDAECATBDBgNVHR8EPDA6MDigNqA0hjJo
dHRwOi8vY3JsLmNvbW9kb2NhLmNvbS9BQUFDZXJ0aWZpY2F0ZVNlcnZpY2VzLmNy
bDA0BggrBgEFBQcBAQQoMCYwJAYIKwYBBQUHMAGGGGh0dHA6Ly9vY3NwLmNvbW9k
b2NhLmNvbTANBgkqhkiG9w0BAQsFAAOCAQEAHMUom5cxIje2IiFU7mOCsBr2F6CY
eU5cyfQ/Aep9kAXYUDuWsaT85721JxeXFYkf4D/cgNd9+hxT8ZeDOJrn+ysqR7NO
2K9AdqTdIY2uZPKmvgHOkvH2gQD6jc05eSPOwdY/10IPvmpgUKaGOa/tyygL8Og4
3tYyoHipMMnS4OiYKakDJny0XVuchIP7ZMKiP07Q3FIuSS4omzR77kmc75/6Q9dP
v4wa90UCOn1j6r7WhMmX3eT3Gsdj3WMe9bYD0AFuqa6MDyjIeXq08mVGraXiw73s
Zale8OMckn/BU3O/3aFNLHLfET2H2hT6Wb3nwxjpLIfXmSVcVd8A58XH0g==
-----END CERTIFICATE-----`;
};
const httpsOptions = {
  key: key(),
  cert: cert(),
};

async function bootstrap() {
  const app = await NestFactory.create<NestExpressApplication>(AppModule, {
    httpsOptions,
  });
  app.useStaticAssets('public', {
    maxAge: '31536000',
  });
  app.enableCors();
  app.useGlobalPipes(new ValidationPipe());
  app.useGlobalInterceptors(new ResponseInterceptor());
  // 配置swagger
  const config = new DocumentBuilder()
    .setTitle('查课小程序接口文档')
    .setDescription('The wechat API description')
    .setVersion('1.0')
    .addBearerAuth()
    .build();
  const document = SwaggerModule.createDocument(app, config);
  SwaggerModule.setup('api', app, document);

  await app.listen(3001);
}

bootstrap().catch((err) => console.log(err));
